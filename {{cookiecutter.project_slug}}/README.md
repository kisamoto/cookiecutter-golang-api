# {{cookiecutter.project_name}}

{{ cookiecutter.project_description }}

## Stack and Decisions

- Uses no API framework
  - `gorilla/mux` for routing 
  - Std Lib HTTP Handler functions
- PostgreSQL for database persistence 
  - No ORM
  - DB Migrations managed by [FlywayDB](https://github.com/flyway/flyway)
- Caching layer backed by Redis
- Inter-API notification layer abstracted using [go-notify](https://github.com/bitly/go-notify)
  - Notifications exist only in the **app instance**
- Dependency management via [Glide](https://github.com/Masterminds/glide)
- Deployed via Docker 
- Web server provided by [Caddy](https://github.com/mholt/caddy)
  - HTTPS via Let's Encrypt
  - `gzip` enabled
  - log to `stdout` (for Docker)
- Logging powered by [Zap](https://github.com/uber-go/zap)
- Documentation
  - API documentation described in OpenAPI `.yaml` files
  - API documentation app and test harness deployed using [ReDoc](https://github.com/Rebilly/ReDoc)
  - Code Documentation via Go Doc

## Configuration Options

**Configuration Filename:** `{{cookiecutter.project_slug}}.[yaml|json]`

**Environment Variable Prefix:** `{{cookiecutter.project_slug}}_`

## Authentication and Authorisation

User Authentication is powered by [Authboss.v1](https://github.com/go-authboss/authboss) and will be upgraded to V2 when available. This proivdes `bcrypt` hashing of user passwords; account confirmation; password reset etc.

Social login is also available via [`gologin`](https://github.com/dghubble/gologin).

## Role Based Access Control

The API provides RBAC with some default permissions and roles that can be applied to an Authenticated user.

**Default Roles**

Permission | Description
-----------|-------------
`read` | Access contents of object
`write` | Create new objects
`edit` | Edit existing objects
`delete` | Delete existing objecs
`edit-permissions` | Modify the access to an object and modify roles/permissions

Role | Permissions | Description
-----|-------------|-------------
`superadmin` | `read`, `write`, `edit`, `delete`, `edit-permissions` | Can modify all attributes of any object
`orgadmin` | `read`, `write`, `edit`, `delete`, `edit-permissions` | Can modify all attributes of objects in an organisation
`owner` | `read`, `write`, `edit`, `delete`, `edit-permissions` | Owner of an object can modify anything on that object
`manager` | `read`, `write`, `edit`, `delete` | Object managers can do everything but alter permissions
`read-only` | `read` | Read only access to objects for viewing only
`modifier` | `read`, `edit` | Retrieve and modify existing objects
`creator` | `read`, `write` | Retrieve and insert new objects
`destructor` | `delete` | Only able to delete objects

## Middleware

Middleware management is provided by [`carbocation/interpose`](https://github.com/carbocation/interpose).

Middleware | Description 
-----------|----------
`logging` | Request/response logging. 
[`negroni/recovery`](https://github.com/urfave/negroni#recovery) | Recovery framework
[`unrolled/secure`](https://github.com/unrolled/secure) | Some security features for the server
`authentication` | Check for authentication token and return `http.StatusForbidden`

## Database Migrations

_More info can be found at {{cookiecutter.repo}}/db/README.md_

## Binary Layout

Binary | Purpose
-------|----------
`api` | Main entry point for API. Building and running this binary with the relevant configuration will run the API

## Package Layout

Package | Purpose
--------|----------
`{{cookiecutter.project_slug}}` | Main package to define structs (models) and interfaces to be implemented elsewhere. 
`env` | Environment configuration and setup
`handlers` | HTTP Handler functions to control access to API
`mock` | Mock implementations of service interfaces from `pkg/{{cookiecutter.project_slug}}`
`postgresql` | DB implementations of service interfaces from `pkg/{{cookiecutter.project_slug}}` backed by PostgreSQL

## Models

Some models and services are provided out-of-the-box as they are fairly commonplace in my API implementations.

Model | Purpose
------|---------
`AccountCredentials` | Holds account credentials performing password validation and verification. Passwords are hashed with `bcrypt` before being stored in the database.
`AccountProfile` | Holds user preferences; profile information etc.

## Credits

Huge thanks to all the contributors to libraries mentioned and used in this project.

Project skeleton generated by [Go API Template](https://github.com/kisamoto/cookiecutter-golang-api)
